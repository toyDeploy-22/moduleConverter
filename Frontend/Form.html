<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>

form {
text-align: center;
}

div {
display: flex;
justify-content: center;
}

#yourSelection {
font-style: italic
}

#yourSelection.readySelected > b {
font-style: initial;
color: darkblue;
}

.notSelected {
color: gold;
font-weight: bold;
}

.notShow {
display: none;
}

.show {
display: block;
font-weight: bold;
}

p[value="ok"] {
color: green;
}

p[value="nok"]{
color: crimson;
}

a.fileLink {
text-decoration: none;
}
</style>
</head>
<body>
<form enctype="multipart/form-data">
<p><b>Please select the format of the file you want</b></p>
<label for="fileSelection"></label>
<select id="fileSelection">
<option value="">Select here</option>
<option value="toJson">From Javascript to JSON</option>
<option value="toJs">From JSON to Javascript</option>
</select>
  <input type="file" name="uplFile" />
  <br /><br />
  <button type="submit">Done</button>
<p id="yourSelection" class="notShow"></p> 
<p class="notShow" value="ok" >Sucess!</p>
<p class="notShow" value="nok" >Failed!</p>
<a id="fileLink" class="notShow">You can get your file here!</a>
</form>
<script>
const form = document.getElementsByTagName("form")[0];
const userSelection = document.getElementsByTagName("p")[1];
const success = document.getElementsByTagName("p")[2];
const failure = document.getElementsByTagName("p")[3];
const myFile = document.getElementsByTagName("input")[0];
const format = document.getElementById("fileSelection");
const urls = [
{
id: "toJson",
description: "From Javascript to JSON",
url: "js-2-json"
}, 
{
id: "toJs",
description: "From JSON to Javascript",
url: "json-2-js"
}];
let conversion = {status: ""};

const downloadLink = document.getElementById("fileLink");


function getUrl(ext) {
const finder = urls.filter((url)=>url.id === ext)[0]; 
switch (finder.id){
case "toJson": 
case "toJs" :
conversion = {status: true,
...finder
};
break;
default:
conversion = {status: false,
url: ""
	}
	}
}

function urlSelected(){
getUrl(format.value);

if(!conversion.status){
userSelection.setAttribute("class", "notSelected");
userSelection.innerHTML = "Now, you just need to select a type of conversion to proceed."
} 
/**
else if (conversion.status && !myFile.files[0]){
userSelection.setAttribute("class", "notSelected");
userSelection.innerHTML = "You will need to upload a file in order to proceed the conversion."
	}**/ 
	else {
	userSelection.setAttribute("class", "readySelected");
userSelection.innerHTML = "You have selected: ";
const boldElem = document.createElement("b");
const boldText = document.createTextNode(conversion.description);
boldElem.appendChild(boldText);
userSelection.appendChild(boldElem);
	}
}

format.addEventListener("change", urlSelected)

async function sendFile(e){
try{
e.preventDefault(); 
if(conversion.status) { 
const url = `http://localhost:5000/convert/${conversion.url}`;
const myForm = new FormData(); // key-value pair form object
const formFile = myFile.files[0]; // ".files" instead of ".value" because we want the file.
myForm.append(myFile.name.toString(), formFile);
/**
IMPORTANT:
Not include
"headers: { "Content-Type": 'multipart/form-data' }"
as this is done by the browser itself.

PLEASE CHECK HOW TO DELETE THE FILE: 
We can use fs.unlink()
try to use req.format and use setRequesHeader() to set response headers
**/
await fetch(url, {
method: 'POST', 
body: myForm, 
});
console.log("sent");
success.setAttribute("class", "show");
downloadLink.classList.remove("notShow");
//downloadLink.setAttribute(
	} else {
userSelection.setAttribute("class", "notSelected");
userSelection.innerHTML = "Make sure you have uploaded a file and selected a format before submission"
}	
} catch(err) {
console.error({message: err});
failure.setAttribute("class", "show");
} 
}
form.addEventListener("submit", sendFile);
</script>
</body>
</html>